<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modal Accessibility Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .test-pass {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .test-fail {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1>Modal Accessibility Test</h1>
        
        <div id="test-results"></div>
        
        <button class="btn btn-primary" onclick="testModalAccessibility()">Test Modal Accessibility</button>
        <button class="btn btn-success" onclick="openTestModal()">Open Test Modal</button>
        
        <!-- Test Modal -->
        <div class="modal fade" id="testModal" tabindex="-1" aria-labelledby="testModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="testModalLabel">Test Modal</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <input type="text" class="form-control" placeholder="Test input field">
                        <button type="button" class="btn btn-secondary mt-2">Test Button</button>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/modal-accessibility.js"></script>
    
    <script>
        function addTestResult(message, passed) {
            const resultsDiv = document.getElementById('test-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${passed ? 'test-pass' : 'test-fail'}`;
            resultDiv.innerHTML = `${passed ? '✅' : '❌'} ${message}`;
            resultsDiv.appendChild(resultDiv);
        }

        function testModalAccessibility() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<h3>Modal Accessibility Test Results:</h3>';
            
            // Test 1: Check if modal accessibility helper is loaded
            if (typeof window.ModalAccessibility !== 'undefined') {
                addTestResult('Modal Accessibility Helper loaded', true);
            } else {
                addTestResult('Modal Accessibility Helper NOT loaded', false);
            }
            
            // Test 2: Check if accessibility enhancer is loaded
            if (typeof window.accessibilityEnhancer !== 'undefined') {
                addTestResult('Accessibility Enhancer loaded', true);
            } else {
                addTestResult('Accessibility Enhancer NOT loaded', false);
            }
            
            // Test 3: Check Bootstrap modal behavior
            const modal = document.getElementById('testModal');
            if (modal) {
                addTestResult('Test modal found', true);
                
                // Check initial state
                if (modal.hasAttribute('aria-hidden') && modal.getAttribute('aria-hidden') === 'true') {
                    addTestResult('Modal initially has aria-hidden="true"', true);
                } else {
                    addTestResult('Modal does NOT have aria-hidden="true" initially', false);
                }
                
                // Check if modal has proper ARIA attributes
                if (modal.hasAttribute('aria-labelledby')) {
                    addTestResult('Modal has aria-labelledby', true);
                } else {
                    addTestResult('Modal missing aria-labelledby', false);
                }
                
                if (modal.hasAttribute('tabindex')) {
                    addTestResult('Modal has tabindex', true);
                } else {
                    addTestResult('Modal missing tabindex', false);
                }
            } else {
                addTestResult('Test modal NOT found', false);
            }
        }

        function openTestModal() {
            const modal = new bootstrap.Modal(document.getElementById('testModal'));
            
            // Listen for modal events
            const modalElement = document.getElementById('testModal');
            
            modalElement.addEventListener('show.bs.modal', function() {
                addTestResult('Modal show event fired', true);
            });
            
            modalElement.addEventListener('shown.bs.modal', function() {
                addTestResult('Modal shown event fired', true);
                
                // Check if aria-hidden was removed
                if (!this.hasAttribute('aria-hidden') || this.getAttribute('aria-hidden') !== 'true') {
                    addTestResult('aria-hidden removed when modal shown', true);
                } else {
                    addTestResult('aria-hidden NOT removed when modal shown', false);
                }
                
                // Check if aria-modal was added
                if (this.hasAttribute('aria-modal') && this.getAttribute('aria-modal') === 'true') {
                    addTestResult('aria-modal="true" set when modal shown', true);
                } else {
                    addTestResult('aria-modal NOT set when modal shown', false);
                }
                
                // Check focus
                const focusedElement = document.activeElement;
                if (focusedElement && modalElement.contains(focusedElement)) {
                    addTestResult('Focus is within modal', true);
                } else {
                    addTestResult('Focus is NOT within modal', false);
                }
            });
            
            modalElement.addEventListener('hide.bs.modal', function() {
                addTestResult('Modal hide event fired', true);
            });
            
            modalElement.addEventListener('hidden.bs.modal', function() {
                addTestResult('Modal hidden event fired', true);
                
                // Check if aria-hidden was restored
                if (this.hasAttribute('aria-hidden') && this.getAttribute('aria-hidden') === 'true') {
                    addTestResult('aria-hidden="true" restored when modal hidden', true);
                } else {
                    addTestResult('aria-hidden NOT restored when modal hidden', false);
                }
            });
            
            modal.show();
        }

        // Test dynamic modal creation
        function testDynamicModal() {
            const dynamicModal = window.ModalAccessibility.createModal({
                id: 'dynamicTestModal',
                title: 'Dynamic Test Modal',
                content: '<p>This is a dynamically created modal</p>'
            });
            
            const bsModal = new bootstrap.Modal(dynamicModal);
            bsModal.show();
        }
    </script>
</body>
</html>
