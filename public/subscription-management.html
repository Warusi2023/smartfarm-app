<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subscription Management - SmartFarm</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c5530;
            --secondary-color: #4a7c59;
            --accent-color: #8fbc8f;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        .subscription-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .plan-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 2rem;
            border-radius: 15px 15px 0 0;
        }

        .plan-badge {
            background: var(--success-color);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .usage-bar {
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
        }

        .usage-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success-color) 0%, var(--accent-color) 100%);
            transition: width 0.3s ease;
        }

        .usage-fill.warning {
            background: linear-gradient(90deg, var(--warning-color) 0%, #ff8c00 100%);
        }

        .usage-fill.danger {
            background: linear-gradient(90deg, var(--danger-color) 0%, #ff4757 100%);
        }

        .feature-list {
            list-style: none;
            padding: 0;
        }

        .feature-list li {
            padding: 0.5rem 0;
            border-bottom: 1px solid #f8f9fa;
        }

        .feature-list li:last-child {
            border-bottom: none;
        }

        .feature-list i {
            color: var(--success-color);
            margin-right: 0.5rem;
        }

        .refund-eligible {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: white;
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
            margin: 1rem 0;
        }

        .btn-primary {
            background: var(--primary-color);
            border-color: var(--primary-color);
        }

        .btn-primary:hover {
            background: var(--secondary-color);
            border-color: var(--secondary-color);
        }

        .btn-danger {
            background: var(--danger-color);
            border-color: var(--danger-color);
        }

        .btn-warning {
            background: var(--warning-color);
            border-color: var(--warning-color);
            color: #000;
        }

        .modal-header {
            background: var(--primary-color);
            color: white;
        }

        .alert-custom {
            border-left: 4px solid var(--warning-color);
            background: #fff3cd;
            border-color: #ffeaa7;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark" style="background: var(--primary-color);">
        <div class="container">
            <a class="navbar-brand" href="dashboard.html">
                <i class="fas fa-seedling me-2"></i>SmartFarm
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="dashboard.html">
                    <i class="fas fa-tachometer-alt me-1"></i>Dashboard
                </a>
            </div>
        </div>
    </nav>

    <div class="container py-5">
        <div class="row">
            <div class="col-12">
                <h1 class="mb-4">
                    <i class="fas fa-credit-card me-2"></i>Subscription Management
                </h1>
            </div>
        </div>

        <!-- Current Subscription -->
        <div class="row">
            <div class="col-lg-8">
                <div class="subscription-card">
                    <div class="plan-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h3 id="currentPlanName">Professional Plan</h3>
                                <p class="mb-0" id="currentPlanDescription">Most popular for serious farmers</p>
                            </div>
                            <div class="plan-badge" id="currentPlanStatus">Active</div>
                        </div>
                        <div class="mt-3">
                            <h4 id="currentPlanPrice">$29<span class="fs-6">/month</span></h4>
                            <p class="mb-0" id="currentPlanPeriod">Billed monthly • Next billing: Jan 15, 2024</p>
                        </div>
                    </div>
                    <div class="p-4">
                        <h5>Current Features</h5>
                        <ul class="feature-list" id="currentPlanFeatures">
                            <li><i class="fas fa-check"></i> Up to 10 farms</li>
                            <li><i class="fas fa-check"></i> Advanced crop management</li>
                            <li><i class="fas fa-check"></i> Complete livestock tracking</li>
                            <li><i class="fas fa-check"></i> AI-powered insights</li>
                            <li><i class="fas fa-check"></i> Weather forecasting</li>
                            <li><i class="fas fa-check"></i> Geofencing & GPS tracking</li>
                            <li><i class="fas fa-check"></i> Financial management</li>
                            <li><i class="fas fa-check"></i> Priority support</li>
                        </ul>

                        <!-- Refund Eligibility -->
                        <div class="refund-eligible" id="refundEligible" style="display: none;">
                            <h6><i class="fas fa-shield-alt me-2"></i>Refund Eligible</h6>
                            <p class="mb-2">You can request a full refund within 30 days of your subscription start date.</p>
                            <button class="btn btn-warning btn-sm" onclick="showRefundModal()">
                                <i class="fas fa-undo me-1"></i>Request Refund
                            </button>
                        </div>

                        <!-- Action Buttons -->
                        <div class="d-flex gap-2 mt-4">
                            <button class="btn btn-primary" onclick="changePlan()">
                                <i class="fas fa-exchange-alt me-1"></i>Change Plan
                            </button>
                            <button class="btn btn-outline-secondary" onclick="updatePaymentMethod()">
                                <i class="fas fa-credit-card me-1"></i>Update Payment
                            </button>
                            <button class="btn btn-outline-danger" onclick="cancelSubscription()">
                                <i class="fas fa-times me-1"></i>Cancel Subscription
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Usage Statistics -->
            <div class="col-lg-4">
                <div class="subscription-card">
                    <div class="p-4">
                        <h5><i class="fas fa-chart-bar me-2"></i>Usage Statistics</h5>
                        
                        <!-- Farms Usage -->
                        <div class="mb-4">
                            <div class="d-flex justify-content-between mb-2">
                                <span>Farms</span>
                                <span id="farmsUsage">3 / 10</span>
                            </div>
                            <div class="usage-bar">
                                <div class="usage-fill" id="farmsBar" style="width: 30%"></div>
                            </div>
                        </div>

                        <!-- API Calls Usage -->
                        <div class="mb-4">
                            <div class="d-flex justify-content-between mb-2">
                                <span>API Calls (This Month)</span>
                                <span id="apiUsage">1,250 / 10,000</span>
                            </div>
                            <div class="usage-bar">
                                <div class="usage-fill" id="apiBar" style="width: 12.5%"></div>
                            </div>
                        </div>

                        <!-- Users Usage -->
                        <div class="mb-4">
                            <div class="d-flex justify-content-between mb-2">
                                <span>Team Members</span>
                                <span id="usersUsage">2 / 5</span>
                            </div>
                            <div class="usage-bar">
                                <div class="usage-fill" id="usersBar" style="width: 40%"></div>
                            </div>
                        </div>

                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <small>Usage resets monthly on your billing date.</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Billing History -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="subscription-card">
                    <div class="p-4">
                        <h5><i class="fas fa-history me-2"></i>Billing History</h5>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Description</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="billingHistory">
                                    <tr>
                                        <td>Dec 15, 2023</td>
                                        <td>Professional Plan - Monthly</td>
                                        <td>$29.00</td>
                                        <td><span class="badge bg-success">Paid</span></td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-primary" onclick="downloadInvoice('inv_001')">
                                                <i class="fas fa-download me-1"></i>Invoice
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Nov 15, 2023</td>
                                        <td>Professional Plan - Monthly</td>
                                        <td>$29.00</td>
                                        <td><span class="badge bg-success">Paid</span></td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-primary" onclick="downloadInvoice('inv_002')">
                                                <i class="fas fa-download me-1"></i>Invoice
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Refund Modal -->
    <div class="modal fade" id="refundModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-undo me-2"></i>Request Refund
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Refund Policy:</strong> You can request a full refund within 30 days of your subscription start date. Refunds are processed within 3-5 business days.
                    </div>
                    
                    <form id="refundForm">
                        <div class="mb-3">
                            <label for="refundReason" class="form-label">Reason for Refund</label>
                            <select class="form-select" id="refundReason" required>
                                <option value="">Select a reason</option>
                                <option value="not-satisfied">Not satisfied with the service</option>
                                <option value="too-expensive">Too expensive</option>
                                <option value="found-alternative">Found a better alternative</option>
                                <option value="technical-issues">Technical issues</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="refundDetails" class="form-label">Additional Details (Optional)</label>
                            <textarea class="form-control" id="refundDetails" rows="3" placeholder="Please provide more details about your refund request..."></textarea>
                        </div>
                        
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="refundConfirmation" required>
                            <label class="form-check-label" for="refundConfirmation">
                                I understand that this will cancel my subscription and I will lose access to all premium features.
                            </label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-warning" onclick="submitRefundRequest()">
                        <i class="fas fa-undo me-1"></i>Submit Refund Request
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Change Plan Modal -->
    <div class="modal fade" id="changePlanModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-exchange-alt me-2"></i>Change Subscription Plan
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-body text-center">
                                    <h6>Free</h6>
                                    <h4>$0<span class="fs-6">/month</span></h4>
                                    <ul class="list-unstyled small">
                                        <li>✓ Up to 2 farms</li>
                                        <li>✓ Basic features</li>
                                    </ul>
                                    <button class="btn btn-outline-primary btn-sm" onclick="selectNewPlan('free')">Select</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card border-primary">
                                <div class="card-body text-center">
                                    <h6>Professional</h6>
                                    <h4>$29<span class="fs-6">/month</span></h4>
                                    <ul class="list-unstyled small">
                                        <li>✓ Up to 10 farms</li>
                                        <li>✓ Advanced features</li>
                                        <li>✓ AI insights</li>
                                    </ul>
                                    <button class="btn btn-primary btn-sm" onclick="selectNewPlan('professional')">Select</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-body text-center">
                                    <h6>Enterprise</h6>
                                    <h4>$99<span class="fs-6">/month</span></h4>
                                    <ul class="list-unstyled small">
                                        <li>✓ Unlimited farms</li>
                                        <li>✓ All features</li>
                                        <li>✓ Custom support</li>
                                    </ul>
                                    <button class="btn btn-outline-primary btn-sm" onclick="selectNewPlan('enterprise')">Select</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Load subscription data
        document.addEventListener('DOMContentLoaded', function() {
            loadSubscriptionData();
        });

        function loadSubscriptionData() {
            // This would typically load from the API
            // For demo purposes, we'll use localStorage
            const subscription = JSON.parse(localStorage.getItem('smartfarm_subscription') || '{}');
            
            if (subscription.plan) {
                updateSubscriptionDisplay(subscription);
            } else {
                // Default to free plan
                updateSubscriptionDisplay({
                    plan: 'free',
                    status: 'active',
                    startDate: new Date().toISOString(),
                    endDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),
                    refundEligible: false
                });
            }
        }

        function updateSubscriptionDisplay(subscription) {
            const plans = {
                free: {
                    name: 'Free Plan',
                    description: 'Perfect for getting started',
                    price: '$0',
                    features: [
                        'Up to 2 farms',
                        'Basic crop management',
                        'Simple livestock tracking',
                        'Basic weather data',
                        'Email support'
                    ]
                },
                professional: {
                    name: 'Professional Plan',
                    description: 'Most popular for serious farmers',
                    price: '$29',
                    features: [
                        'Up to 10 farms',
                        'Advanced crop management',
                        'Complete livestock tracking',
                        'AI-powered insights',
                        'Weather forecasting',
                        'Geofencing & GPS tracking',
                        'Financial management',
                        'Priority support'
                    ]
                },
                enterprise: {
                    name: 'Enterprise Plan',
                    description: 'For large-scale operations',
                    price: '$99',
                    features: [
                        'Unlimited farms',
                        'Everything in Professional',
                        'Multi-user management',
                        'Advanced analytics',
                        'Custom integrations',
                        'White-label options',
                        'Dedicated support'
                    ]
                }
            };

            const plan = plans[subscription.plan];
            if (plan) {
                document.getElementById('currentPlanName').textContent = plan.name;
                document.getElementById('currentPlanDescription').textContent = plan.description;
                document.getElementById('currentPlanPrice').innerHTML = plan.price + '<span class="fs-6">/month</span>';
                document.getElementById('currentPlanStatus').textContent = subscription.status.charAt(0).toUpperCase() + subscription.status.slice(1);
                
                // Update features list
                const featuresList = document.getElementById('currentPlanFeatures');
                featuresList.innerHTML = plan.features.map(feature => 
                    `<li><i class="fas fa-check"></i> ${feature}</li>`
                ).join('');

                // Show refund eligibility if within 30 days
                const startDate = new Date(subscription.startDate);
                const now = new Date();
                const daysSinceStart = Math.floor((now - startDate) / (1000 * 60 * 60 * 24));
                
                if (daysSinceStart <= 30 && subscription.refundEligible) {
                    document.getElementById('refundEligible').style.display = 'block';
                }
            }
        }

        function showRefundModal() {
            const refundModal = new bootstrap.Modal(document.getElementById('refundModal'));
            refundModal.show();
        }

        function submitRefundRequest() {
            const reason = document.getElementById('refundReason').value;
            const details = document.getElementById('refundDetails').value;
            const confirmation = document.getElementById('refundConfirmation').checked;

            if (!reason || !confirmation) {
                alert('Please fill in all required fields and confirm your request.');
                return;
            }

            // Simulate refund request
            alert('Refund request submitted successfully! You will receive a confirmation email within 24 hours.');
            
            // Close modal
            const refundModal = bootstrap.Modal.getInstance(document.getElementById('refundModal'));
            refundModal.hide();
            
            // Reset form
            document.getElementById('refundForm').reset();
        }

        function changePlan() {
            const changePlanModal = new bootstrap.Modal(document.getElementById('changePlanModal'));
            changePlanModal.show();
        }

        function selectNewPlan(plan) {
            if (confirm(`Are you sure you want to change to the ${plan} plan?`)) {
                // Simulate plan change
                alert(`Plan changed to ${plan}! Changes will take effect immediately.`);
                
                // Update local storage
                const subscription = JSON.parse(localStorage.getItem('smartfarm_subscription') || '{}');
                subscription.plan = plan;
                localStorage.setItem('smartfarm_subscription', JSON.stringify(subscription));
                
                // Update display
                updateSubscriptionDisplay(subscription);
                
                // Close modal
                const changePlanModal = bootstrap.Modal.getInstance(document.getElementById('changePlanModal'));
                changePlanModal.hide();
            }
        }

        function updatePaymentMethod() {
            alert('Redirecting to payment method update... (This would integrate with your payment processor)');
        }

        function cancelSubscription() {
            if (confirm('Are you sure you want to cancel your subscription? You will lose access to all premium features.')) {
                if (confirm('This action cannot be undone. Are you absolutely sure?')) {
                    // Simulate cancellation
                    alert('Subscription cancelled. You will retain access until the end of your current billing period.');
                    
                    // Update local storage
                    const subscription = JSON.parse(localStorage.getItem('smartfarm_subscription') || '{}');
                    subscription.status = 'cancelled';
                    localStorage.setItem('smartfarm_subscription', JSON.stringify(subscription));
                    
                    // Update display
                    updateSubscriptionDisplay(subscription);
                }
            }
        }

        function downloadInvoice(invoiceId) {
            alert(`Downloading invoice ${invoiceId}... (This would generate and download a PDF invoice)`);
        }
    </script>
</body>
</html>
