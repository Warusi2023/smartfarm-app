<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>SmartFarm</title>
  </head>
  <body>
    <div id="app"></div>
    <script type="module">
      // at the very top
      import "./src/svg-sanitizer";
      import "./src/quiet-externals";
      
      import API_URL from "./src/env.ts";
      const el = document.getElementById("app");
      // Use production API URL if env var is not set
      const apiBaseUrl = API_URL || 'https://smartfarm-app-production.up.railway.app';
      el.innerHTML = "<h1>SmartFarm Web</h1><p>API: " + apiBaseUrl + "</p>";
      // Use /api/health endpoint (which exists and works)
      const healthUrl = apiBaseUrl.endsWith('/api') ? apiBaseUrl + '/health' : apiBaseUrl + '/api/health';
      fetch(healthUrl)
        .then(r => {
          if (!r.ok) throw new Error(`HTTP ${r.status}`);
          return r.json();
        })
        .then(j => el.insertAdjacentHTML("beforeend", "<pre>"+JSON.stringify(j,null,2)+"</pre>"))
        .catch(e => { 
          console.error('Health check failed:', e); 
          el.insertAdjacentHTML("beforeend","<p style='color:red'>API call failed: " + e.message + "</p>");
        });
    </script>
  </body>
</html>