# üöÇ Railway Deployment Guide for SmartFarm

This guide will walk you through deploying your SmartFarm application to Railway with the exact configuration generated by the environment sync script.

## üìã **Prerequisites**

- Railway account (free tier available)
- GitHub repository connected to Railway
- SmartFarm project code pushed to GitHub

## üéØ **Deployment Overview**

You have **2 services** to deploy:
1. **Backend Service** (`smartfarm-app`) - API server
2. **Frontend Service** (`web`) - Static website

---

## üöÄ **Step 1: Create Railway Project**

1. Go to [Railway.app](https://railway.app)
2. Click **"New Project"**
3. Select **"Deploy from GitHub repo"**
4. Choose your `smartfarm-app` repository
5. Railway will automatically detect your project

---

## üîß **Step 2: Configure Backend Service (smartfarm-app)**

### **2.1 Create Backend Service**
1. In your Railway project, click **"+ New Service"**
2. Select **"GitHub Repo"**
3. Choose your repository
4. Name it: `smartfarm-app`

### **2.2 Configure Service Settings**
Go to **Settings** ‚Üí **General** and set:

| Setting | Value |
|---------|-------|
| **Root Directory** | `backend-api` |
| **Build Command** | `npm run build` |
| **Start Command** | `npm run start` |
| **Install Command** | `npm ci` |

### **2.3 Set Environment Variables**
Go to **Settings** ‚Üí **Variables** and add:

```bash
NODE_ENV=production
PORT=3000
CORS_ORIGIN=https://smartfarm-web-production.up.railway.app
```

### **2.4 Configure Health Check**
Go to **Settings** ‚Üí **Health** and set:
- **Health Check Path**: `/api/health`
- **Health Check Timeout**: `120 seconds`

---

## üåê **Step 3: Configure Frontend Service (web)**

### **3.1 Create Frontend Service**
1. In your Railway project, click **"+ New Service"**
2. Select **"GitHub Repo"**
3. Choose your repository (same one)
4. Name it: `web`

### **3.2 Configure Service Settings**
Go to **Settings** ‚Üí **General** and set:

| Setting | Value |
|---------|-------|
| **Root Directory** | `web-project` |
| **Build Command** | `npm run build` |
| **Start Command** | `npm run start` |

### **3.3 Set Environment Variables**
Go to **Settings** ‚Üí **Variables** and add:

```bash
NODE_ENV=production
VITE_API_URL=https://smartfarm-app-production.up.railway.app/api
NEXT_PUBLIC_API_URL=https://smartfarm-app-production.up.railway.app/api
REACT_APP_API_URL=https://smartfarm-app-production.up.railway.app/api
```

### **3.4 Configure Health Check**
Go to **Settings** ‚Üí **Health** and set:
- **Health Check Path**: `/`
- **Health Check Timeout**: `120 seconds`

---

## üîÑ **Step 4: Deploy Services**

### **4.1 Deploy Backend First**
1. Go to the `smartfarm-app` service
2. Click **"Deploy"**
3. Wait for deployment to complete
4. Note the generated URL (e.g., `https://smartfarm-app-production.up.railway.app`)

### **4.2 Update Frontend Environment Variables**
1. Go to the `web` service settings
2. Update the environment variables with the actual backend URL:
   ```bash
   VITE_API_URL=https://YOUR-ACTUAL-BACKEND-URL.up.railway.app/api
   NEXT_PUBLIC_API_URL=https://YOUR-ACTUAL-BACKEND-URL.up.railway.app/api
   REACT_APP_API_URL=https://YOUR-ACTUAL-BACKEND-URL.up.railway.app/api
   ```

### **4.3 Deploy Frontend**
1. Go to the `web` service
2. Click **"Deploy"**
3. Wait for deployment to complete
4. Note the generated URL (e.g., `https://smartfarm-web-production.up.railway.app`)

---

## ‚úÖ **Step 5: Verify Deployment**

### **5.1 Test Backend API**
1. Open your backend URL + `/api/health`
2. You should see: `{"ok":true,"service":"SmartFarm","ts":1234567890}`
3. Example: `https://smartfarm-app-production.up.railway.app/api/health`

### **5.2 Test Frontend**
1. Open your frontend URL
2. Check browser console for any API errors
3. Verify the application loads correctly

### **5.3 Test CORS**
1. Open frontend in browser
2. Try to make API calls
3. Check browser network tab for successful requests

---

## üîß **Step 6: Update CORS Configuration**

After both services are deployed, update the backend CORS configuration:

1. Go to `smartfarm-app` service settings
2. Update the `CORS_ORIGIN` variable with your actual frontend URL:
   ```bash
   CORS_ORIGIN=https://YOUR-ACTUAL-FRONTEND-URL.up.railway.app
   ```
3. Redeploy the backend service

---

## üö® **Troubleshooting**

### **Backend Issues**

**Problem**: Backend fails to start
- **Solution**: Check that `backend-api/server.cjs` exists and `package.json` has correct start script

**Problem**: Health check fails
- **Solution**: Verify `/api/health` endpoint is accessible

**Problem**: CORS errors
- **Solution**: Update `CORS_ORIGIN` with actual frontend URL

### **Frontend Issues**

**Problem**: Frontend fails to build
- **Solution**: Check that `web-project/package.json` has build script

**Problem**: API calls fail
- **Solution**: Verify `VITE_API_URL` points to correct backend URL

**Problem**: 404 errors
- **Solution**: Check root directory is set to `web-project`

### **General Issues**

**Problem**: Services not connecting
- **Solution**: Verify environment variables are set correctly

**Problem**: Build failures
- **Solution**: Check that all required files exist in the correct directories

---

## üìä **Expected Results**

After successful deployment:

‚úÖ **Backend Service**:
- URL: `https://smartfarm-app-production.up.railway.app`
- Health check: `https://smartfarm-app-production.up.railway.app/api/health`
- CORS configured for frontend

‚úÖ **Frontend Service**:
- URL: `https://smartfarm-web-production.up.railway.app`
- API calls work without CORS errors
- Application loads and functions correctly

---

## üîÑ **Automatic Deployments**

Railway will automatically redeploy when you push changes to your main branch. Make sure to:

1. **Test locally** before pushing
2. **Update environment variables** if needed
3. **Monitor deployment logs** for errors

---

## üìû **Need Help?**

- Check Railway deployment logs in the dashboard
- Verify all environment variables are set
- Ensure file paths and commands are correct
- Test endpoints manually to isolate issues

**Your SmartFarm application should now be fully deployed and accessible!** üéâ